# json
用了c++的json库nlohnann挺好用 对stl容器库都做了兼容
参考博客
https://www.cnblogs.com/linuxAndMcu/p/14503341.html#_label2_2

使用代码示例：
```
namespace disk {
  struct DiskMetricV2
  {
    std::string key;
    int64_t offset;
    int64_t size;
    int64_t minTimestamp;
    int64_t maxTimestamp;
    int64_t numDataPoints;
  };
  struct MetaV2
  {
    int64_t minTimestamp;
    int64_t maxTimestamp;
    int64_t numDataPoints;
    int64_t createAt;
    std::unordered_map<std::string, std::vector<std::shared_ptr<DiskMetricV2>>>metrics;
  };
  void to_json(json & j, const DiskMetricV2 & diskMetricV2);
  void from_json(const json & j, DiskMetricV2 & diskMetricV2);
  void to_json(json & j, const MetaV2 & metaV2);
  void from_json(const json & j, MetaV2 & metaV2);
}

void disk::to_json(json &j, const DiskMetricV2 &diskMetricV2) {
  j["key"] = diskMetricV2.key;
  j["offset"] = diskMetricV2.offset;
  j["size"] = diskMetricV2.size;
  j["minTimestamp"] = diskMetricV2.minTimestamp;
  j["maxTimestamp"] = diskMetricV2.maxTimestamp;
  j["numDataPoints"] = diskMetricV2.numDataPoints;
}

void disk::from_json(const json& j, DiskMetricV2& diskMetricV2) {
  j.at("key").get_to(diskMetricV2.key);
  j.at("offset").get_to(diskMetricV2.offset);
  j.at("size").get_to(diskMetricV2.size);
  j.at("minTimestamp").get_to(diskMetricV2.minTimestamp);
  j.at("maxTimestamp").get_to(diskMetricV2.maxTimestamp);
  j.at("numDataPoints").get_to(diskMetricV2.numDataPoints);
}

void disk::to_json(json &j, const MetaV2 &metaV2) {
  j["minTimestamp"] = metaV2.minTimestamp;
  j["maxTimestamp"] = metaV2.maxTimestamp;
  j["numDataPoints"] = metaV2.numDataPoints;
  j["createAt"] = metaV2.createAt;
  for (auto &tmp : metaV2.metrics) {
    for (auto &diskMetric : tmp.second) {
      json jDiskMetric;
      to_json(jDiskMetric, *diskMetric);
      j["metrics"][tmp.first].push_back(jDiskMetric);
    }
  }
}

void disk::from_json(const json& j, MetaV2& metaV2) {
  j.at("minTimestamp").get_to(metaV2.minTimestamp);
  j.at("maxTimestamp").get_to(metaV2.maxTimestamp);
  j.at("numDataPoints").get_to(metaV2.numDataPoints);
  j.at("createAt").get_to(metaV2.createAt);
  for (auto tmp : j.at("metrics")) {
    for (auto jdiskMetric : tmp) {
      std::shared_ptr<disk::DiskMetricV2>diskMetric(new DiskMetricV2);
      from_json(jdiskMetric, *diskMetric);
      metaV2.metrics[diskMetric->key].push_back(diskMetric);
    }
  }
}
```

#libhv gin风格的c++ http框架 构建一个http-server非常简洁
```
# include "hv/HttpServer.h"

void
start_http_server()
{
  hv::HttpService service;

  service.GET("/", [](HttpRequest* req, HttpResponse* resp) {
    return 200;
  });

  service.POST("/query", [](const HttpContextPtr& ctx) {
    std::string = "hello";
    return ctx->send(str, ctx->type());
  });

  http_server_t server;
  server.port = 8080;
  server.service = &service;
  http_server_run(&server);
}

```

# fmt python风格的printf
可以直接打印 容器库vector map等等 非常方便
使用方法见官网的example https://github.com/fmtlib/fmt
大致是下面这样的 可以说是非常方便了 在开发时输出debug日志的时候
```
Print to stdout

#include <fmt/core.h>

int main() {
  fmt::print("Hello, world!\n");
}

Format a string

std::string s = fmt::format("The answer is {}.", 42);
// s == "The answer is 42."
Format a string using positional arguments (run)

std::string s = fmt::format("I'd rather be {1} than {0}.", "right", "happy");
// s == "I'd rather be happy than right."
Print chrono durations (run)

#include <fmt/chrono.h>

int main() {
  using namespace std::literals::chrono_literals;
  fmt::print("Default format: {} {}\n", 42s, 100ms);
  fmt::print("strftime-like format: {:%H:%M:%S}\n", 3h + 15min + 30s);
}
Output:

Default format: 42s 100ms
strftime-like format: 03:15:30
Print a container (run)

#include <vector>
#include <fmt/ranges.h>

int main() {
  std::vector<int> v = {1, 2, 3};
  fmt::print("{}\n", v);
}
Output:

[1, 2, 3]
Check a format string at compile time

std::string s = fmt::format("{:d}", "I am not a number");
This gives a compile-time error in C++20 because d is an invalid format specifier for a string.

Write a file from a single thread

#include <fmt/os.h>

int main() {
  auto out = fmt::output_file("guide.txt");
  out.print("Don't {}", "Panic");
}
This can be 5 to 9 times faster than fprintf.

Print with colors and text styles

#include <fmt/color.h>

int main() {
  fmt::print(fg(fmt::color::crimson) | fmt::emphasis::bold,
             "Hello, {}!\n", "world");
  fmt::print(fg(fmt::color::floral_white) | bg(fmt::color::slate_gray) |
             fmt::emphasis::underline, "Hello, {}!\n", "мир");
  fmt::print(fg(fmt::color::steel_blue) | fmt::emphasis::italic,
             "Hello, {}!\n", "世界");
}
```